{% extends "base.html" %}

{% block title %}Edit Product - POS System{% endblock %}
{% block page_title %}Edit Product{% endblock %}
{% block page_subtitle %}Update product information{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-xl shadow p-6">
        <form method="POST" action="/products/edit/{{ product.id }}" class="space-y-6">
            <!-- Basic Information -->
            <div>
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Basic Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Product Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Product Name *
                        </label>
                        <input type="text" name="name" value="{{ product.name }}"
                               class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="Product Name" required>
                    </div>

                    <!-- SKU -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            SKU (Stock Keeping Unit) *
                        </label>
                        <input type="text" name="sku" value="{{ product.sku }}"
                               class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="PROD-001" required>
                    </div>

                    <!-- Price -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Selling Price *
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₦</span>
                            <input type="number" name="price" value="{{ product.price }}"
                                   step="0.01" min="0"
                                   class="w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                   placeholder="0.00" required>
                        </div>
                    </div>

                    <!-- Cost Price -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Cost Price
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₦</span>
                            <input type="number" name="cost_price" value="{{ product.cost_price or 0 }}"
                                   step="0.01" min="0"
                                   class="w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                   placeholder="0.00">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Information -->
            <div>
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Inventory Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Stock Quantity -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Current Stock
                        </label>
                        <input type="number" name="stock_quantity" value="{{ product.stock_quantity }}"
                               min="0"
                               class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="0">
                    </div>

                    <!-- Reorder Level -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Reorder Level
                        </label>
                        <input type="number" name="reorder_level" value="{{ product.reorder_level or 10 }}"
                               min="0"
                               class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="10">
                        <p class="text-xs text-gray-500 mt-1">Alert when stock falls below this level</p>
                    </div>

                    <!-- Category -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Category
                        </label>
                        <input type="text" name="category" value="{{ product.category or '' }}"
                               class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="e.g., Beverages, Snacks">
                    </div>
                </div>
            </div>

            <!-- Description -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Description
                </label>
                <textarea name="description" rows="3"
                          class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                          placeholder="Product description">{{ product.description or '' }}</textarea>
            </div>

            <!-- Form Actions -->
            <div class="flex justify-between items-center pt-6 border-t">
                <div>
                    <a href="/products" class="text-gray-600 hover:text-gray-800 font-medium">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Products
                    </a>
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="confirmDelete({{ product.id }})"
                            class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium">
                        <i class="fas fa-trash mr-2"></i>Delete
                    </button>
                    <button type="submit"
                            class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                        <i class="fas fa-save mr-2"></i>Update Product
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full">
        <div class="p-6">
            <div class="text-center mb-6">
                <i class="fas fa-exclamation-triangle text-3xl text-red-600 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-800">Delete Product</h3>
                <p class="text-gray-600 mt-2">Are you sure you want to delete this product? This action cannot be undone.</p>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeDeleteModal()"
                        class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">
                    Cancel
                </button>
                <button id="confirmDeleteBtn"
                        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                    Delete Product
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let productToDelete = null;

function confirmDelete(productId) {
    productToDelete = productId;
    document.getElementById('deleteModal').classList.remove('hidden');

    // Set up delete button
    document.getElementById('confirmDeleteBtn').onclick = function() {
        deleteProduct(productId);
    };
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
    productToDelete = null;
}

async function deleteProduct(productId) {
    try {
        const response = await fetch(`/products/delete/${productId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });

        const result = await response.json();

        if (result.success) {
            alert('Product deleted successfully!');
            window.location.href = '/products';
        } else {
            alert('Error: ' + result.message);
            closeDeleteModal();
        }
    } catch (error) {
        console.error('Error deleting product:', error);
        alert('Network error: ' + error.message);
        closeDeleteModal();
    }
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeDeleteModal();
    }
});

// Close modal when clicking outside
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});
</script>
{% endblock %}